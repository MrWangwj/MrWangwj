---
title: PHP 中对象的复制
date: 2018-02-24 19:44:05
categories: PHP
tags:
- PHP
- 对象复制
---
PHP中的对象在复制是通过 `clone` 来复制对象的

```PHP
<?php
class A{
    public static $n = 0;
    public $s;
    public function __construct(){
        $this->s = ++self::$n;
    }
}
$a1 = new A();
$a1->s = -1;
$a2 = $a1;
echo $a1->s;
echo '<br>';
echo $a2->s;
/**
 * 输出
 * -1
 * -1
 */

$a1 = new A();
$a2 = clone $a1;
$a1->s = -1;
echo $a1->s;
echo '<br>';
echo $a2->s;
/**
 * 输出
 * -1
 * 2
 */
```
<!-- more -->
说到 clone 复制，clone复制会对对象的所有属性执行一个浅复制。所有的引用属性 仍然会是一个指向原来的变量的引用，要想实现复制需要 `__clone` 魔术方法。
在下面例子的输出中可以看出，`a1` 在 `__clone` 方法中进行了`clone`,所以两个`b`中的`a1`值发生了变话，成为了两个不同的对象。而`a2`没有进行设置，所以值一样，还是同一个对象。

```PHP
<?php
class A{
    public static $n = 0;
    public $s;
    public function __construct(){
        $this->s = ++self::$n;
    }

    public function __clone() {
        $this->s = ++ self::$n;
    }
}


class B{
    public $a1;
    public $a2;

    public function __clone() {
        $this->a1 = clone $this->a1;
        //$this->a2 = clone $this->a2;    //省略a2的复制
    }
}


$b1 = new B();
$b1->a1 = new A();
$b1->a2 = new A();

$b2 = clone $b1;

var_dump($b1);
var_dump($b2);

/* 输出

    /Applications/MAMP/htdocs/PHP学习/面向对象/对象复制/demo2.php:31:
    object(B)[1]
      public 'a1' =>
        object(A)[2]
          public 's' => int 1
      public 'a2' =>
        object(A)[3]
          public 's' => int 2

    /Applications/MAMP/htdocs/PHP学习/面向对象/对象复制/demo2.php:32:
    object(B)[4]
      public 'a1' =>
        object(A)[5]
          public 's' => int 3
      public 'a2' =>
        object(A)[3]
          public 's' => int 2
 */
```
